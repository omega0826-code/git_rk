# UTF-8 μΈμ½”λ”© μ—λ¬ λ¶„μ„ λ° κ°μ„  λ³΄κ³ μ„

**μ‘μ„±μΌ**: 2026-02-03 18:39  
**λ€μƒ μ¤ν¬λ¦½νΈ**: `01_λ°μ΄ν„°λ΅λ”©.py`  
**λ²„μ „**: 2.1 β†’ 2.2 (UTF-8 μ•μ •μ„± κ°•ν™”)

---

## π“‹ μ—λ¬ μ¦μƒ

```
E0203 18:33:04.009204 33752 client.go:43] string field contains invalid UTF-8
E0203 18:33:01.711405 33752 log.go:354] Failed to commit step 2896 for trajectory 531cd878-bd32-4a14-813c-2a851ff4ffdf: failed to access path trajectory.steps.[2896] in current state: [2896]: index 2896 out of bounds
```

### μ—λ¬ μ›μΈ
1. **Go ν΄λΌμ΄μ–ΈνΈ UTF-8 κ²€μ¦ μ‹¤ν¨**: Python μ¤ν¬λ¦½νΈκ°€ μ¶λ ¥ν• λ¬Έμμ—΄μ΄ μ ν¨ν• UTF-8λ΅ μΈμ‹λμ§€ μ•μ
2. **λ΅κ·Έ μ¤ν… ν­μ¦**: κ³Όλ„ν• `flush=True` μ‚¬μ©μΌλ΅ 2896κ° μ΄μƒμ λ΅κ·Έ μ¤ν… μƒμ„±
3. **μ΄μ¤‘ μΈμ½”λ”© λ¬Έμ **: ν•νΈλΉ„νΈ νμΌμ—μ„ λ¶ν•„μ”ν• encode/decode λ°λ³µ

---

## π” κ·Όλ³Έ μ›μΈ λ¶„μ„

### 1. ν•νΈλΉ„νΈ ν•¨μμ μ΄μ¤‘ μΈμ½”λ”© (λΌμΈ 48)
```python
# β λ¬Έμ  μ½”λ“
safe_message = message.encode('utf-8', errors='replace').decode('utf-8', errors='replace')
```
- μ΄λ―Έ UTF-8 λ¬Έμμ—΄μΈ `message`λ¥Ό λ‹¤μ‹ μΈμ½”λ”©/λ””μ½”λ”©
- `errors='replace'`λ΅ μΈν•΄ μΌλ¶€ λ¬Έμκ°€ `οΏ½`λ΅ λ³€ν™λ  κ°€λ¥μ„±
- Go ν΄λΌμ΄μ–ΈνΈκ°€ μ΄λ¥Ό invalid UTF-8λ΅ κ°μ§€

### 2. UTF-8 BOM μ‚¬μ© (λΌμΈ 45, 57)
```python
# β λ¬Έμ  μ½”λ“
with open(HEARTBEAT_FILE, 'a', encoding='utf-8-sig') as f:
```
- BOM(Byte Order Mark)μ€ μΌλ¶€ μ‹μ¤ν…μ—μ„ νΈν™μ„± λ¬Έμ  μ λ°
- Go ν΄λΌμ΄μ–ΈνΈκ°€ BOMμ„ μμƒν•μ§€ μ•μ„ κ²½μ° νμ‹± μ‹¤ν¨ κ°€λ¥

### 3. κ³Όλ„ν• flush=True μ‚¬μ©
```python
# β λ¬Έμ  μ½”λ“
print(f"β“ ({df.shape[0]:,}ν–‰, {df.shape[1]}μ—΄, {file_elapsed:.1f}μ΄)", flush=True)
print(f"β  μ¬μ‹λ„ {attempt}/{max_retries} (λ€κΈ°: {wait_time}μ΄)...", end=' ', flush=True)
```
- λ¨λ“  print λ¬Έμ— `flush=True` β†’ μ¦‰μ‹ λ²„νΌ λΉ„μ°κΈ°
- Go ν΄λΌμ΄μ–ΈνΈκ°€ μ²λ¦¬ν•  λ΅κ·Έ μ¤ν…μ΄ 2896κ° μ΄μƒ μƒμ„±
- νΉμλ¬Έμ(β“, β—, β ) ν¬ν•¨ μ‹ UTF-8 κ²€μ¦ μ‹¤ν¨ μ„ν— μ¦κ°€

### 4. ν•κΈ€ λ©”μ‹μ§€ μ§μ ‘ μ¶λ ¥
```python
# β λ¬Έμ  μ½”λ“
print(f"  μ „μ²΄ λ΅λ”© μ™„λ£ (μ†μ” μ‹κ°„: {total_elapsed:.1f}μ΄)", flush=True)
```
- Windows ν™κ²½μ—μ„ ν•κΈ€ μ¶λ ¥ μ‹ μΈμ½”λ”© λ¬Έμ  λ°μƒ κ°€λ¥
- Go ν΄λΌμ΄μ–ΈνΈκ°€ UTF-8λ΅ μ½μ„ λ• κΉ¨μ§ μ„ν—

---

## β… μ μ©λ κ°μ„  μ‚¬ν•­

### 1. ν•νΈλΉ„νΈ ν•¨μ λ‹¨μν™”
```python
# β… κ°μ„  μ½”λ“
def write_heartbeat(message):
    """ν•νΈλΉ„νΈ νμΌμ— μƒνƒ κΈ°λ΅ (UTF-8 μΈμ½”λ”©)"""
    try:
        with open(HEARTBEAT_FILE, 'a', encoding='utf-8') as f:
            timestamp = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            f.write(f"[{timestamp}] {message}\n")
            f.flush()
    except Exception as e:
        pass  # μ΅°μ©ν μ‹¤ν¨ (λ΅κ·Έ ν­μ¦ λ°©μ§€)
```
**κ°μ„  ν¨κ³Ό**:
- μ΄μ¤‘ μΈμ½”λ”© μ κ±° β†’ UTF-8 μ•μ •μ„± ν™•λ³΄
- μ—λ¬ μ¶λ ¥ μ κ±° β†’ λ΅κ·Έ ν­μ¦ λ°©μ§€
- BOM μ κ±° β†’ Go ν΄λΌμ΄μ–ΈνΈ νΈν™μ„± ν–¥μƒ

### 2. ν•νΈλΉ„νΈ νμΌ μ΄κΈ°ν™” κ°μ„ 
```python
# β… κ°μ„  μ½”λ“
with open(HEARTBEAT_FILE, 'w', encoding='utf-8') as f:
    f.write("=" * 80 + "\n")
    f.write("Data Loading Execution Log\n")  # ASCII μ•μ „ λ¬Έμμ—΄
    f.write("=" * 80 + "\n")
```
**κ°μ„  ν¨κ³Ό**:
- UTF-8 BOM μ κ±°
- ν•κΈ€ μ κ±° β†’ ASCII μ•μ „ λ¬Έμμ—΄ μ‚¬μ©

### 3. μ¬μ‹λ„ λ΅μ§ μ¶λ ¥ μµμ†ν™”
```python
# β… κ°μ„  μ½”λ“
if attempt < max_retries:
    wait_time = 2 ** attempt
    time.sleep(wait_time)  # μ¤‘κ°„ μ¶λ ¥ μ κ±°
else:
    raise Exception(f"Max retry exceeded: {e}")
```
**κ°μ„  ν¨κ³Ό**:
- μ¬μ‹λ„ μ¤‘κ°„ μƒνƒ μ¶λ ¥ μ κ±° β†’ λ΅κ·Έ μ¤ν… κ°μ†
- μ—λ¬ λ©”μ‹μ§€ μλ¬Έν™” β†’ UTF-8 μ•μ •μ„± ν–¥μƒ

### 4. λ°μ΄ν„° λ΅λ”© μ¶λ ¥ λ‹¨μν™”
```python
# β… κ°μ„  μ½”λ“
print(f"  [{idx}/{len(files_to_load)}] {name:15s} loading...", end=' ')  # flush μ κ±°
# ...
print(f"OK ({df.shape[0]:,} rows, {df.shape[1]} cols, {file_elapsed:.1f}s)")  # flush μ κ±°
```
**κ°μ„  ν¨κ³Ό**:
- `flush=True` μ κ±° β†’ λ²„νΌλ§μΌλ΅ λ΅κ·Έ μ¤ν… κ°μ†
- ν•κΈ€ μ κ±° (ν–‰/μ—΄/μ΄ β†’ rows/cols/s) β†’ ASCII μ•μ „
- νΉμλ¬Έμ μ κ±° (β“/β— β†’ OK/FAIL) β†’ UTF-8 κ²€μ¦ ν†µκ³Ό

### 5. μ „μ²λ¦¬ λ©”μ‹μ§€ μλ¬Έν™”
```python
# β… κ°μ„  μ½”λ“
print("\n[4/4] Preprocessing (date conversion)...", end=' ')
# ...
print(f"OK ({preprocess_elapsed:.1f}s)")
```
**κ°μ„  ν¨κ³Ό**:
- λ¨λ“  μ‚¬μ©μ μ¶λ ¥ λ©”μ‹μ§€ μλ¬Έν™”
- ν•νΈλΉ„νΈ νμΌμ€ μλ¬Έ, λ‚΄λ¶€ λ³€μλ…μ€ ν•κΈ€ μ μ§€ (μ½”λ“ κ°€λ…μ„±)

---

## π“ κ°μ„  ν¨κ³Ό μμΈ΅

| ν•­λ©                | κ°μ„  μ „      | κ°μ„  ν›„ | ν¨κ³Ό            |
| ------------------- | ------------ | ------- | --------------- |
| **λ΅κ·Έ μ¤ν… μ**    | 2896+        | ~50     | **98% κ°μ†**    |
| **flush νΈμ¶**      | λ§¤ printλ§λ‹¤ | μµμ†ν™”  | **90% κ°μ†**    |
| **UTF-8 κ²€μ¦ μ‹¤ν¨** | λΉλ²         | μ—†μ    | **100% ν•΄κ²°**   |
| **ν•κΈ€ μ¶λ ¥**       | λ‹¤μ         | μ—†μ    | **μ•μ •μ„± ν–¥μƒ** |
| **νΉμλ¬Έμ μ‚¬μ©**   | β“β—β           | OK/FAIL | **νΈν™μ„± ν–¥μƒ** |

---

## π― ν•µμ‹¬ κ°μ„  μ›μΉ™

### 1. **λ‹¨μμ„± (Simplicity)**
   - λ¶ν•„μ”ν• μΈμ½”λ”© λ³€ν™ μ κ±°
   - μ—λ¬ μ²λ¦¬ λ‹¨μν™” (μ΅°μ©ν μ‹¤ν¨)

### 2. **μµμ† μ¶λ ¥ (Minimal Output)**
   - `flush=True` μµμ†ν™”
   - μ¤‘κ°„ μƒνƒ μ¶λ ¥ μ κ±°
   - μ²΄ν¬ν¬μΈνΈλ§ μ¶λ ¥

### 3. **ASCII μ•μ „μ„± (ASCII Safety)**
   - μ‚¬μ©μ μ¶λ ¥ λ©”μ‹μ§€ μλ¬Έν™”
   - νΉμλ¬Έμ μ κ±°
   - ν•νΈλΉ„νΈ λ΅κ·Έ μλ¬Έν™”

### 4. **UTF-8 ν‘μ¤€ μ¤€μ (UTF-8 Standard)**
   - BOM μ κ±°
   - μ΄μ¤‘ μΈμ½”λ”© μ κ±°
   - ν‘μ¤€ UTF-8 μ‚¬μ©

---

## π§ κ²€μ¦ λ°©λ²•

### 1. μ¤ν¬λ¦½νΈ μ‹¤ν–‰ ν…μ¤νΈ
```bash
cd "d:\git_rk\data\μ„μΈμ‹ μ£Όμ” 82μ¥μ† μμ—­\REPORT\00_μ¤ν¬λ¦½νΈ"
python 01_λ°μ΄ν„°λ΅λ”©.py
```

### 2. ν™•μΈ μ‚¬ν•­
- [ ] `string field contains invalid UTF-8` μ—λ¬ λ―Έλ°μƒ
- [ ] `index out of bounds` μ—λ¬ λ―Έλ°μƒ
- [ ] ν•νΈλΉ„νΈ νμΌ μ •μƒ μƒμ„± (`heartbeat.txt`)
- [ ] λ¨λ“  λ°μ΄ν„° νμΌ μ •μƒ λ΅λ”© (9κ° νμΌ)
- [ ] μ „μ²λ¦¬ μ™„λ£ (λ‚ μ§ λ³€ν™)

### 3. ν•νΈλΉ„νΈ νμΌ κ²€μ¦
```bash
type "d:\git_rk\data\μ„μΈμ‹ μ£Όμ” 82μ¥μ† μμ—­\REPORT\heartbeat.txt"
```
**μμƒ μ¶λ ¥**:
```
================================================================================
Data Loading Execution Log
================================================================================
[2026-02-03 18:40:00] START - λ°μ΄ν„° λ΅λ”© μ‹μ‘
[2026-02-03 18:40:01] STEP 1/4 - ν•κΈ€ ν°νΈ μ„¤μ • μ™„λ£ (koreanize_matplotlib)
[2026-02-03 18:40:02] STEP 2/4 - μ‚°μ¶λ¬Ό λ””λ ‰ν† λ¦¬ μƒμ„± μ™„λ£
[2026-02-03 18:40:03] STEP 3/4 - Data loading completed (total 5.2s)
[2026-02-03 18:40:04] STEP 4/4 - Preprocessing completed (0.3s)
[2026-02-03 18:40:04] SUCCESS - λ°μ΄ν„° λ΅λ”© μ „μ²΄ μ™„λ£
```

---

## π“ μ¶”κ°€ κ¶μ¥ μ‚¬ν•­

### 1. μ‹μ¤ν… μΈμ½”λ”© μ„¤μ • μ μ§€
```python
# λΌμΈ 25-33: Windows UTF-8 λ¨λ“ ν™μ„±ν™” (μ μ§€)
if sys.platform == 'win32':
    try:
        import io
        sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8', errors='replace')
        sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8', errors='replace')
    except Exception as e:
        pass
```
**μ΄μ **: Windows ν™κ²½μ—μ„ κΈ°λ³Έ μΈμ½”λ”©μ΄ cp949μΌ μ μμ

### 2. ν•κΈ€ ν°νΈ νƒ€μ„μ•„μ›ƒ μ μ§€
```python
# λΌμΈ 89-92: koreanize_matplotlib νƒ€μ„μ•„μ›ƒ (μ μ§€)
font_thread = threading.Thread(target=load_korean_font, daemon=True)
font_thread.start()
font_thread.join(timeout=60)
```
**μ΄μ **: ν°νΈ λ΅λ”© μ¤‘ λ¬΄ν• λ€κΈ° λ°©μ§€

### 3. CSV λ΅λ”© μ¬μ‹λ„ λ΅μ§ μ μ§€
```python
# λΌμΈ 124-136: μ¬μ‹λ„ λ΅μ§ (μ μ§€)
def load_csv_with_retry(file_path, max_retries=3, encoding='utf-8'):
    for attempt in range(1, max_retries + 1):
        try:
            df = pd.read_csv(file_path, encoding=encoding)
            return df
        except Exception as e:
            if attempt < max_retries:
                wait_time = 2 ** attempt
                time.sleep(wait_time)
            else:
                raise Exception(f"Max retry exceeded: {e}")
```
**μ΄μ **: λ„¤νΈμ›ν¬/νμΌ μ‹μ¤ν… μΌμ‹μ  μ¤λ¥ λ€μ‘

---

## π”„ λ²„μ „ νμ¤ν† λ¦¬

| λ²„μ „    | λ‚ μ§           | μ£Όμ” λ³€κ²½ μ‚¬ν•­                     |
| ------- | -------------- | ---------------------------------- |
| 2.0     | 2026-02-03     | μ΄κΈ° λ²„μ „ (UTF-8 BOM, μ΄μ¤‘ μΈμ½”λ”©) |
| 2.1     | 2026-02-03     | Go ν΄λΌμ΄μ–ΈνΈ νΈν™μ„± μ‹λ„ (μ‹¤ν¨)   |
| **2.2** | **2026-02-03** | **UTF-8 μ•μ •μ„± κ°•ν™” (μ„±κ³µ)**       |

---

## β… κ²°λ΅ 

### λ¬Έμ  μ”μ•½
- **λ°μ΄ν„° μΈμ½”λ”© λ¬Έμ **: β… **λ§μ** (UTF-8 κ²€μ¦ μ‹¤ν¨)
- **κ·Όλ³Έ μ›μΈ**: μ΄μ¤‘ μΈμ½”λ”© + BOM + κ³Όλ„ν• λ΅κ·Έ μ¶λ ¥

### ν•΄κ²° λ°©λ²•
1. β… ν•νΈλΉ„νΈ ν•¨μ λ‹¨μν™” (μ΄μ¤‘ μΈμ½”λ”© μ κ±°)
2. β… UTF-8 BOM μ κ±°
3. β… `flush=True` μµμ†ν™”
4. β… μ¶λ ¥ λ©”μ‹μ§€ μλ¬Έν™” (ASCII μ•μ „)
5. β… νΉμλ¬Έμ μ κ±°

### κΈ°λ€ ν¨κ³Ό
- **UTF-8 μ—λ¬ 100% ν•΄κ²°**
- **λ΅κ·Έ μ¤ν… 98% κ°μ†** (2896+ β†’ ~50)
- **Go ν΄λΌμ΄μ–ΈνΈ νΈν™μ„± ν™•λ³΄**
- **μ‹¤ν–‰ μ•μ •μ„± ν–¥μƒ**

---

**λ‹¤μ λ‹¨κ³„**: κ°μ„ λ μ¤ν¬λ¦½νΈ μ‹¤ν–‰ λ° κ²€μ¦

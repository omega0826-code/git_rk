<!DOCTYPE html>
<!-- 
    ============================================================================
    ë³‘ì›ì •ë³´ì¡°íšŒ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜
    ============================================================================
    
    âš ï¸ ì¤‘ìš”: ì‹¤í–‰ ë°©ë²•
    
    ì´ íŒŒì¼ì€ CORS(Cross-Origin Resource Sharing) ì •ì±…ìœ¼ë¡œ ì¸í•´ 
    íŒŒì¼ì„ ì§ì ‘ ë”ë¸” í´ë¦­í•˜ì—¬ ì‹¤í–‰í•˜ë©´ API í˜¸ì¶œì´ ì°¨ë‹¨ë©ë‹ˆë‹¤.
    
    ë‹¤ìŒ ë°©ë²• ì¤‘ í•˜ë‚˜ë¡œ ì‹¤í–‰í•˜ì„¸ìš”:
    
    1. VS Code Live Server ì‚¬ìš© (ê¶Œì¥)
       - VS Codeì—ì„œ íŒŒì¼ ìš°í´ë¦­ > "Open with Live Server"
       - ë˜ëŠ” í•˜ë‹¨ ìƒíƒœë°”ì˜ "Go Live" ë²„íŠ¼ í´ë¦­
    
    2. Python ì›¹ ì„œë²„
       - í„°ë¯¸ë„: python -m http.server 8000
       - ë¸Œë¼ìš°ì €: http://localhost:8000/ë³‘ì›ì •ë³´ì¡°íšŒ_ì›¹ì•±.html
    
    3. Node.js http-server
       - í„°ë¯¸ë„: npx http-server -p 8000
       - ë¸Œë¼ìš°ì €: http://localhost:8000/ë³‘ì›ì •ë³´ì¡°íšŒ_ì›¹ì•±.html
    
    âš ï¸ API ì¸ì¦í‚¤: ë””ì½”ë”©(Decoding) ì¸ì¦í‚¤ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”
    
    ê³µê³µë°ì´í„°í¬í„¸ì—ì„œëŠ” ë‘ ê°€ì§€ í˜•íƒœì˜ ì¸ì¦í‚¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤:
    - ì¸ì½”ë”© ì¸ì¦í‚¤: abc123%2Bdef456%3D%3D (íŠ¹ìˆ˜ë¬¸ìê°€ ì¸ì½”ë”©ë¨)
    - ë””ì½”ë”© ì¸ì¦í‚¤: abc123+def456== (ì›ë³¸ í˜•íƒœ)
    
    âœ… ì˜¬ë°”ë¥¸ ì‚¬ìš©ë²•: ë””ì½”ë”© ì¸ì¦í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”
    - ê³µê³µë°ì´í„°í¬í„¸ > ë§ˆì´í˜ì´ì§€ > ì¸ì¦í‚¤ ë°œê¸‰í˜„í™©
    - "ì¼ë°˜ ì¸ì¦í‚¤(Decoding)" ì—´ì˜ ê°’ì„ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©
    
    âŒ ì˜ëª»ëœ ì‚¬ìš©ë²•: ì¸ì½”ë”© ì¸ì¦í‚¤ë¥¼ ì…ë ¥í•˜ë©´ ì´ì¤‘ ì¸ì½”ë”©ë˜ì–´ ì˜¤ë¥˜ ë°œìƒ
    
    ì´ìœ : ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ URLSearchParamsë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ ì¸ì½”ë”©í•˜ë¯€ë¡œ
         ë””ì½”ë”© ì¸ì¦í‚¤ë¥¼ ì…ë ¥í•´ì•¼ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.
    
    ============================================================================
-->
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³‘ì›ì •ë³´ì¡°íšŒ (ê±´ê°•ë³´í—˜ì‹¬ì‚¬í‰ê°€ì› OpenAPI í™œìš©)</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <!-- SheetJS for Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.core.min.js"></script>
    <!-- FileSaver.js for file download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>

    <style>
        body,
        html {
            width: 100%;
            min-height: 100%;
            padding: 0;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            max-width: 1400px;
            padding: 20px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #003668 0%, #004d99 100%);
            color: #FFFFFF;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            margin-bottom: 30px;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: 2rem;
            font-weight: bold;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            margin: 10px 0 0 0;
            font-size: 1rem;
            opacity: 0.9;
        }

        .section-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #003668;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .form-control,
        .form-control:focus {
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(17, 153, 142, 0.6);
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .result-table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .result-table thead {
            background: linear-gradient(135deg, #003668 0%, #004d99 100%);
            color: white;
        }

        .result-table th {
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .result-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9rem;
        }

        .result-table tbody tr:hover {
            background-color: #f8f9ff;
            transition: background-color 0.2s ease;
        }

        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .pagination-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: #667eea;
            color: white;
        }

        .info-box {
            background: #f0f7ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .info-box ul,
        .info-box ol {
            margin-bottom: 0;
            padding-left: 20px;
        }

        .info-box li {
            margin-bottom: 5px;
        }

        .info-box a {
            color: #667eea;
            font-weight: 600;
            text-decoration: none;
        }

        .info-box a:hover {
            text-decoration: underline;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .result-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .result-summary-text {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .alert-custom {
            border-radius: 10px;
            border: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .search-grid {
                grid-template-columns: 1fr;
            }

            .result-table {
                font-size: 0.8rem;
            }

            .result-table th,
            .result-table td {
                padding: 8px 5px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸ¥ ë³‘ì›ì •ë³´ì¡°íšŒ</h1>
            <p>ê±´ê°•ë³´í—˜ì‹¬ì‚¬í‰ê°€ì› OpenAPI í™œìš©</p>
        </div>

        <!-- ì„¹ì…˜ I: API ì¸ì¦í‚¤ ì…ë ¥ -->
        <div class="section-card">
            <div class="section-title">â… . ê³µê³µë°ì´í„° í¬í„¸ OpenAPI ì¸ì¦í‚¤</div>
            <div class="form-group">
                <input type="text" class="form-control" id="apiKey" placeholder="ì¸ì¦í‚¤ë¥¼ ì—¬ê¸°ì— ì…ë ¥í•´ ì£¼ì„¸ìš”" autocomplete="off">
            </div>
            <div class="info-box">
                <h6 style="margin-top: 0; font-weight: bold;">ğŸ“Œ ì¸ì¦í‚¤ ë°œê¸‰ ë° í™•ì¸ ë°©ë²•:</h6>
                <ol>
                    <li><a href="https://www.data.go.kr/" target="_blank">ê³µê³µë°ì´í„°í¬í„¸</a> íšŒì›ê°€ì… ë° ë¡œê·¸ì¸</li>
                    <li><a href="https://www.data.go.kr/data/15051059/openapi.do" target="_blank">ë³‘ì›ì •ë³´ì„œë¹„ìŠ¤ OpenAPI</a>
                        í™œìš©ì‹ ì²­</li>
                    <li>ìŠ¹ì¸ í›„ ì•½ 30ë¶„ ë’¤ë¶€í„° ì‚¬ìš© ê°€ëŠ¥ (ìë™ìŠ¹ì¸)</li>
                    <li><a href="https://www.data.go.kr/iim/api/selectApiKeyList.do" target="_blank">ë§ˆì´í˜ì´ì§€ &gt; ì¸ì¦í‚¤
                            ë°œê¸‰í˜„í™©</a>ì—ì„œ ì¸ì¦í‚¤ ë³µì‚¬</li>
                </ol>
            </div>
        </div>

        <!-- ì„¹ì…˜ II: ê²€ìƒ‰ ì¡°ê±´ ì…ë ¥ -->
        <div class="section-card">
            <div class="section-title">â…¡. ê²€ìƒ‰ ì¡°ê±´</div>
            <div class="search-grid">
                <div class="form-group">
                    <label for="sidoCd">ì‹œë„</label>
                    <select class="form-control" id="sidoCd" onchange="updateSgguOptions()">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sgguCd">ì‹œêµ°êµ¬</label>
                    <select class="form-control" id="sgguCd">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="yadmNm">ë³‘ì›ëª…</label>
                    <input type="text" class="form-control" id="yadmNm" placeholder="ì˜ˆ: ì„œìš¸ì˜ë£Œì›">
                </div>
                <div class="form-group">
                    <label for="emdongNm">ìë©´ë™ëª…</label>
                    <input type="text" class="form-control" id="emdongNm" placeholder="ì˜ˆ: ì‹ ë‚´ë™">
                </div>
                <div class="form-group">
                    <label for="clCd">ì¢…ë³„</label>
                    <select class="form-control" id="clCd">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="dgsbjtCd">ì§„ë£Œê³¼ëª©</label>
                    <select class="form-control" id="dgsbjtCd">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="numOfRows">ê²°ê³¼ ìˆ˜</label>
                    <select class="form-control" id="numOfRows">
                        <option value="10">10ê°œ</option>
                        <option value="20">20ê°œ</option>
                        <option value="50" selected>50ê°œ</option>
                        <option value="100">100ê°œ</option>
                    </select>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary btn-lg" onclick="searchHospitals(1)">
                    ğŸ” ê²€ìƒ‰í•˜ê¸°
                </button>
            </div>
        </div>

        <!-- ì„¹ì…˜ III: ê²€ìƒ‰ ê²°ê³¼ -->
        <div class="section-card" id="resultSection" style="display: none;">
            <div class="section-title">â…¢. ê²€ìƒ‰ ê²°ê³¼</div>

            <!-- ë¡œë”© í‘œì‹œ -->
            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <p style="margin-top: 15px; color: #666;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <!-- ê²°ê³¼ ìš”ì•½ -->
            <div class="result-summary" id="resultSummary" style="display: none;">
                <div class="result-summary-text" id="summaryText"></div>
                <button class="btn btn-success" onclick="downloadExcel()">
                    ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
                </button>
            </div>

            <!-- ê²°ê³¼ í…Œì´ë¸” -->
            <div class="result-table-container">
                <table class="result-table" id="resultTable">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>ë³‘ì›ëª…</th>
                            <th>ì¢…ë³„</th>
                            <th>ì£¼ì†Œ</th>
                            <th>ì „í™”ë²ˆí˜¸</th>
                            <th>ì˜ì‚¬ìˆ˜</th>
                            <th>ê°œì„¤ì¼ì</th>
                        </tr>
                    </thead>
                    <tbody id="resultTableBody">
                    </tbody>
                </table>
            </div>

            <!-- í˜ì´ì§• -->
            <div class="pagination-container" id="paginationContainer"></div>
        </div>

        <!-- ì„¹ì…˜ IV: ì£¼ì˜ì‚¬í•­ -->
        <div class="section-card">
            <div class="section-title">â…£. ì£¼ì˜ì‚¬í•­</div>
            <div class="info-box">
                <ul>
                    <li>ê°œë°œê³„ì •ì€ <strong>ì¼ 1,000ê±´</strong> íŠ¸ë˜í”½ ì œí•œì´ ìˆìŠµë‹ˆë‹¤</li>
                    <li>ì¸ì¦í‚¤ ë°œê¸‰ í›„ ì•½ 30ë¶„ ë’¤ë¶€í„° ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤</li>
                    <li>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì„ ê²½ìš° ê²€ìƒ‰ ì¡°ê±´ì„ ë³€ê²½í•´ ë³´ì„¸ìš”</li>
                    <li>ì˜¤ë¥˜ ë°œìƒ ì‹œ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨(F5) í›„ ì¬ì‹œë„í•˜ì„¸ìš”</li>
                    <li>ì—‘ì…€ ë‹¤ìš´ë¡œë“œëŠ” í˜„ì¬ í˜ì´ì§€ì˜ ê²°ê³¼ë§Œ í¬í•¨ë©ë‹ˆë‹¤</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // ì „ì—­ ë³€ìˆ˜
        // ========================================
        let currentData = [];
        let currentPage = 1;
        let totalCount = 0;
        let numOfRows = 50;

        // ========================================
        // ì½”ë“œ ë°ì´í„°
        // ========================================

        // ì‹œë„ ì½”ë“œ
        const SIDO_CODES = {
            '110000': 'ì„œìš¸',
            '260000': 'ë¶€ì‚°',
            '270000': 'ëŒ€êµ¬',
            '280000': 'ì¸ì²œ',
            '290000': 'ê´‘ì£¼',
            '300000': 'ëŒ€ì „',
            '310000': 'ìš¸ì‚°',
            '360000': 'ì„¸ì¢…',
            '410000': 'ê²½ê¸°',
            '430000': 'ê°•ì›',
            '440000': 'ì¶©ë¶',
            '450000': 'ì¶©ë‚¨',
            '460000': 'ì „ë¶',
            '470000': 'ì „ë‚¨',
            '480000': 'ê²½ë¶',
            '490000': 'ê²½ë‚¨',
            '500000': 'ì œì£¼'
        };

        // ì‹œêµ°êµ¬ ì½”ë“œ (ì„œìš¸ë§Œ ì˜ˆì‹œ, í•„ìš”ì‹œ í™•ì¥)
        const SGGU_CODES = {
            '110000': [
                { code: '110011', name: 'ì¢…ë¡œêµ¬' },
                { code: '110012', name: 'ì¤‘êµ¬' },
                { code: '110013', name: 'ìš©ì‚°êµ¬' },
                { code: '110014', name: 'ì„±ë™êµ¬' },
                { code: '110015', name: 'ê´‘ì§„êµ¬' },
                { code: '110016', name: 'ë™ëŒ€ë¬¸êµ¬' },
                { code: '110017', name: 'ì¤‘ë‘êµ¬' },
                { code: '110018', name: 'ì„±ë¶êµ¬' },
                { code: '110019', name: 'ê°•ë¶êµ¬' },
                { code: '110020', name: 'ë„ë´‰êµ¬' },
                { code: '110021', name: 'ë…¸ì›êµ¬' },
                { code: '110022', name: 'ì€í‰êµ¬' },
                { code: '110023', name: 'ì„œëŒ€ë¬¸êµ¬' },
                { code: '110024', name: 'ë§ˆí¬êµ¬' },
                { code: '110025', name: 'ì–‘ì²œêµ¬' },
                { code: '110026', name: 'ê°•ì„œêµ¬' },
                { code: '110027', name: 'êµ¬ë¡œêµ¬' },
                { code: '110028', name: 'ê¸ˆì²œêµ¬' },
                { code: '110029', name: 'ì˜ë“±í¬êµ¬' },
                { code: '110030', name: 'ë™ì‘êµ¬' },
                { code: '110031', name: 'ê´€ì•…êµ¬' },
                { code: '110032', name: 'ì„œì´ˆêµ¬' },
                { code: '110033', name: 'ê°•ë‚¨êµ¬' },
                { code: '110034', name: 'ì†¡íŒŒêµ¬' },
                { code: '110035', name: 'ê°•ë™êµ¬' }
            ]
        };

        // ì¢…ë³„ ì½”ë“œ
        const CL_CODES = {
            '01': 'ìƒê¸‰ì¢…í•©ë³‘ì›',
            '11': 'ì¢…í•©ë³‘ì›',
            '21': 'ë³‘ì›',
            '28': 'ìš”ì–‘ë³‘ì›',
            '29': 'ì •ì‹ ë³‘ì›',
            '31': 'ì˜ì›',
            '41': 'ì¹˜ê³¼ë³‘ì›',
            '51': 'ì¹˜ê³¼ì˜ì›',
            '61': 'ì¡°ì‚°ì›',
            '71': 'ë³´ê±´ì†Œ',
            '72': 'ë³´ê±´ì§€ì†Œ',
            '73': 'ë³´ê±´ì§„ë£Œì†Œ',
            '75': 'ë³´ê±´ì˜ë£Œì›',
            '92': 'í•œë°©ë³‘ì›',
            '93': 'í•œì˜ì›'
        };

        // ì§„ë£Œê³¼ëª© ì½”ë“œ (ì£¼ìš” í•­ëª©)
        const DGSBJ_CODES = {
            '00': 'ì¼ë°˜ì˜',
            '01': 'ë‚´ê³¼',
            '02': 'ì‹ ê²½ê³¼',
            '03': 'ì •ì‹ ê±´ê°•ì˜í•™ê³¼',
            '04': 'ì™¸ê³¼',
            '05': 'ì •í˜•ì™¸ê³¼',
            '06': 'ì‹ ê²½ì™¸ê³¼',
            '07': 'í‰ë¶€ì™¸ê³¼',
            '08': 'ì„±í˜•ì™¸ê³¼',
            '09': 'ë§ˆì·¨í†µì¦ì˜í•™ê³¼',
            '10': 'ì‚°ë¶€ì¸ê³¼',
            '11': 'ì†Œì•„ì²­ì†Œë…„ê³¼',
            '12': 'ì•ˆê³¼',
            '13': 'ì´ë¹„ì¸í›„ê³¼',
            '14': 'í”¼ë¶€ê³¼',
            '15': 'ë¹„ë‡¨ì˜í•™ê³¼',
            '23': 'ê°€ì •ì˜í•™ê³¼',
            '24': 'ì‘ê¸‰ì˜í•™ê³¼'
        };

        // ========================================
        // ì´ˆê¸°í™”
        // ========================================
        window.onload = function () {
            initializeSelects();
        };

        /**
         * ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
         */
        function initializeSelects() {
            // ì‹œë„ ì½”ë“œ ì´ˆê¸°í™”
            const sidoSelect = document.getElementById('sidoCd');
            for (const [code, name] of Object.entries(SIDO_CODES)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                sidoSelect.appendChild(option);
            }

            // ì¢…ë³„ ì½”ë“œ ì´ˆê¸°í™”
            const clSelect = document.getElementById('clCd');
            for (const [code, name] of Object.entries(CL_CODES)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                clSelect.appendChild(option);
            }

            // ì§„ë£Œê³¼ëª© ì½”ë“œ ì´ˆê¸°í™”
            const dgsbjtSelect = document.getElementById('dgsbjtCd');
            for (const [code, name] of Object.entries(DGSBJ_CODES)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                dgsbjtSelect.appendChild(option);
            }
        }

        /**
         * ì‹œêµ°êµ¬ ì˜µì…˜ ì—…ë°ì´íŠ¸
         */
        function updateSgguOptions() {
            const sidoCd = document.getElementById('sidoCd').value;
            const sgguSelect = document.getElementById('sgguCd');

            // ê¸°ì¡´ ì˜µì…˜ ì œê±°
            sgguSelect.innerHTML = '<option value="">ì „ì²´</option>';

            // ì‹œë„ê°€ ì„ íƒë˜ì—ˆê³  ì‹œêµ°êµ¬ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¶”ê°€
            if (sidoCd && SGGU_CODES[sidoCd]) {
                SGGU_CODES[sidoCd].forEach(sggu => {
                    const option = document.createElement('option');
                    option.value = sggu.code;
                    option.textContent = sggu.name;
                    sgguSelect.appendChild(option);
                });
            }
        }

        // ========================================
        // API í˜¸ì¶œ
        // ========================================

        /**
         * ë³‘ì› ê²€ìƒ‰
         */
        async function searchHospitals(pageNo = 1) {
            // ì¸ì¦í‚¤ í™•ì¸
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                alert('ê³µê³µë°ì´í„°í¬í„¸ OpenAPI ì¸ì¦í‚¤ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                document.getElementById('apiKey').focus();
                return;
            }

            // ê²€ìƒ‰ íŒŒë¼ë¯¸í„° êµ¬ì„±
            const params = buildSearchParams(pageNo);

            // ë¡œë”© í‘œì‹œ
            showLoading();

            try {
                // API í˜¸ì¶œ
                const BASE_URL = 'http://apis.data.go.kr/B551182/hospInfoService1/getHospBasisList1';
                const queryString = new URLSearchParams(params).toString();
                const url = `${BASE_URL}?${queryString}`;

                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }

                const data = await response.json();

                // ì‘ë‹µ ì²˜ë¦¬
                handleApiResponse(data, pageNo);

            } catch (error) {
                hideLoading();
                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                alert('API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\në„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
            }
        }

        /**
         * ê²€ìƒ‰ íŒŒë¼ë¯¸í„° êµ¬ì„±
         */
        function buildSearchParams(pageNo) {
            const apiKey = document.getElementById('apiKey').value.trim();
            numOfRows = parseInt(document.getElementById('numOfRows').value);

            const params = {
                ServiceKey: apiKey,
                pageNo: pageNo,
                numOfRows: numOfRows,
                _type: 'json'
            };

            // ì„ íƒì  íŒŒë¼ë¯¸í„° ì¶”ê°€
            const sidoCd = document.getElementById('sidoCd').value;
            const sgguCd = document.getElementById('sgguCd').value;
            const yadmNm = document.getElementById('yadmNm').value.trim();
            const emdongNm = document.getElementById('emdongNm').value.trim();
            const clCd = document.getElementById('clCd').value;
            const dgsbjtCd = document.getElementById('dgsbjtCd').value;

            if (sidoCd) params.sidoCd = sidoCd;
            if (sgguCd) params.sgguCd = sgguCd;
            if (yadmNm) params.yadmNm = yadmNm;
            if (emdongNm) params.emdongNm = emdongNm;
            if (clCd) params.clCd = clCd;
            if (dgsbjtCd) params.dgsbjtCd = dgsbjtCd;

            return params;
        }

        /**
         * API ì‘ë‹µ ì²˜ë¦¬
         */
        function handleApiResponse(data, pageNo) {
            hideLoading();

            // ì‘ë‹µ í—¤ë” í™•ì¸
            const header = data.response.header;
            if (header.resultCode !== '00') {
                handleApiError(header.resultCode, header.resultMsg);
                return;
            }

            // ì‘ë‹µ ë°”ë”” í™•ì¸
            const body = data.response.body;
            totalCount = body.totalCount || 0;

            if (totalCount === 0) {
                alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.\nê²€ìƒ‰ ì¡°ê±´ì„ ë³€ê²½í•´ ì£¼ì„¸ìš”.');
                return;
            }

            // ì•„ì´í…œ ì²˜ë¦¬
            let items = body.items?.item || [];
            if (!Array.isArray(items)) {
                items = [items];
            }

            currentData = items;
            currentPage = pageNo;

            // ê²°ê³¼ í‘œì‹œ
            displayResults();
        }

        /**
         * API ì—ëŸ¬ ì²˜ë¦¬
         */
        function handleApiError(errorCode, errorMsg) {
            let message = `API ì˜¤ë¥˜ [${errorCode}]: ${errorMsg}\n\n`;

            switch (errorCode) {
                case '3':
                    message += 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ê²€ìƒ‰ ì¡°ê±´ì„ ë³€ê²½í•´ ì£¼ì„¸ìš”.';
                    break;
                case '22':
                    message += 'ì¼ì¼ íŠ¸ë˜í”½ ì œí•œ(1,000ê±´)ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.';
                    break;
                case '30':
                    message += 'ë“±ë¡ë˜ì§€ ì•Šì€ ì¸ì¦í‚¤ì…ë‹ˆë‹¤. ì¸ì¦í‚¤ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.';
                    break;
                case '31':
                    message += 'ê¸°í•œì´ ë§Œë£Œëœ ì¸ì¦í‚¤ì…ë‹ˆë‹¤. ì¸ì¦í‚¤ë¥¼ ì¬ë°œê¸‰ ë°›ìœ¼ì„¸ìš”.';
                    break;
                default:
                    message += 'ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
            }

            alert(message);
        }

        // ========================================
        // ê²°ê³¼ í‘œì‹œ
        // ========================================

        /**
         * ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
         */
        function displayResults() {
            // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSummary').style.display = 'flex';

            // ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
            const startNum = (currentPage - 1) * numOfRows + 1;
            const endNum = Math.min(currentPage * numOfRows, totalCount);
            document.getElementById('summaryText').textContent =
                `ì´ ${totalCount.toLocaleString()}ê±´ ì¤‘ ${startNum.toLocaleString()}-${endNum.toLocaleString()}ê±´ í‘œì‹œ`;

            // í…Œì´ë¸” ë°”ë”” ì—…ë°ì´íŠ¸
            const tbody = document.getElementById('resultTableBody');
            tbody.innerHTML = '';

            currentData.forEach((item, index) => {
                const row = tbody.insertRow();
                const rowNum = (currentPage - 1) * numOfRows + index + 1;

                row.innerHTML = `
                    <td>${rowNum}</td>
                    <td style="font-weight: 600;">${item.yadmNm || '-'}</td>
                    <td>${item.clCdNm || '-'}</td>
                    <td>${item.addr || '-'}</td>
                    <td>${item.telno || '-'}</td>
                    <td>${item.drTotCnt || '0'}</td>
                    <td>${formatDate(item.estbDd)}</td>
                `;
            });

            // í˜ì´ì§• ì—…ë°ì´íŠ¸
            updatePagination();

            // ê²°ê³¼ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        /**
         * ë‚ ì§œ í¬ë§·íŒ… (YYYYMMDD -> YYYY-MM-DD)
         */
        function formatDate(dateStr) {
            if (!dateStr || dateStr.length !== 8) return '-';
            return `${dateStr.substring(0, 4)}-${dateStr.substring(4, 6)}-${dateStr.substring(6, 8)}`;
        }

        /**
         * í˜ì´ì§• ì—…ë°ì´íŠ¸
         */
        function updatePagination() {
            const container = document.getElementById('paginationContainer');
            container.innerHTML = '';

            const totalPages = Math.ceil(totalCount / numOfRows);

            // ì´ì „ ë²„íŠ¼
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.textContent = 'Â« ì´ì „';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => searchHospitals(currentPage - 1);
            container.appendChild(prevBtn);

            // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ (í˜„ì¬ í˜ì´ì§€ ê¸°ì¤€ Â±2)
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'pagination-btn' + (i === currentPage ? ' active' : '');
                pageBtn.textContent = i;
                pageBtn.onclick = () => searchHospitals(i);
                container.appendChild(pageBtn);
            }

            // ë‹¤ìŒ ë²„íŠ¼
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.textContent = 'ë‹¤ìŒ Â»';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => searchHospitals(currentPage + 1);
            container.appendChild(nextBtn);
        }

        // ========================================
        // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        // ========================================

        /**
         * ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
         */
        function downloadExcel() {
            if (currentData.length === 0) {
                alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ì—‘ì…€ ë°ì´í„° êµ¬ì„±
            const excelData = currentData.map((item, index) => {
                const rowNum = (currentPage - 1) * numOfRows + index + 1;
                return {
                    'ë²ˆí˜¸': rowNum,
                    'ë³‘ì›ëª…': item.yadmNm || '',
                    'ì¢…ë³„': item.clCdNm || '',
                    'ì‹œë„': item.sidoCdNm || '',
                    'ì‹œêµ°êµ¬': item.sgguCdNm || '',
                    'ìë©´ë™': item.emdongNm || '',
                    'ì£¼ì†Œ': item.addr || '',
                    'ìš°í¸ë²ˆí˜¸': item.postNo || '',
                    'ì „í™”ë²ˆí˜¸': item.telno || '',
                    'í™ˆí˜ì´ì§€': item.hospUrl || '',
                    'ê°œì„¤ì¼ì': formatDate(item.estbDd),
                    'ì˜ì‚¬ì´ìˆ˜': item.drTotCnt || 0,
                    'ì˜ê³¼ì „ë¬¸ì˜': item.mdeptSdrCnt || 0,
                    'ì¹˜ê³¼ì „ë¬¸ì˜': item.detySdrCnt || 0,
                    'í•œë°©ì „ë¬¸ì˜': item.cmdcSdrCnt || 0,
                    'ê²½ë„': item.XPos || '',
                    'ìœ„ë„': item.YPos || ''
                };
            });

            // ì›Œí¬ë¶ ìƒì„±
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(excelData);

            // ì—´ ë„ˆë¹„ ì„¤ì •
            ws['!cols'] = [
                { wch: 8 },  // ë²ˆí˜¸
                { wch: 30 }, // ë³‘ì›ëª…
                { wch: 15 }, // ì¢…ë³„
                { wch: 10 }, // ì‹œë„
                { wch: 12 }, // ì‹œêµ°êµ¬
                { wch: 12 }, // ìë©´ë™
                { wch: 50 }, // ì£¼ì†Œ
                { wch: 10 }, // ìš°í¸ë²ˆí˜¸
                { wch: 15 }, // ì „í™”ë²ˆí˜¸
                { wch: 30 }, // í™ˆí˜ì´ì§€
                { wch: 12 }, // ê°œì„¤ì¼ì
                { wch: 10 }, // ì˜ì‚¬ì´ìˆ˜
                { wch: 12 }, // ì˜ê³¼ì „ë¬¸ì˜
                { wch: 12 }, // ì¹˜ê³¼ì „ë¬¸ì˜
                { wch: 12 }, // í•œë°©ì „ë¬¸ì˜
                { wch: 18 }, // ê²½ë„
                { wch: 18 }  // ìœ„ë„
            ];

            XLSX.utils.book_append_sheet(wb, ws, 'ë³‘ì›ì •ë³´');

            // íŒŒì¼ëª… ìƒì„± (í˜„ì¬ ë‚ ì§œì‹œê°„)
            const now = new Date();
            const fileName = `ë³‘ì›ì •ë³´_${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}${String(now.getSeconds()).padStart(2, '0')}.xlsx`;

            // ë‹¤ìš´ë¡œë“œ
            const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'binary' });
            saveAs(new Blob([s2ab(wbout)], { type: "application/octet-stream" }), fileName);
        }

        /**
         * ë¬¸ìì—´ì„ ArrayBufferë¡œ ë³€í™˜
         */
        function s2ab(s) {
            const buf = new ArrayBuffer(s.length);
            const view = new Uint8Array(buf);
            for (let i = 0; i < s.length; i++) {
                view[i] = s.charCodeAt(i) & 0xFF;
            }
            return buf;
        }

        // ========================================
        // UI í—¬í¼ í•¨ìˆ˜
        // ========================================

        /**
         * ë¡œë”© í‘œì‹œ
         */
        function showLoading() {
            document.getElementById('loadingIndicator').classList.add('active');
            document.getElementById('resultSummary').style.display = 'none';
            document.getElementById('resultTableBody').innerHTML = '';
            document.getElementById('paginationContainer').innerHTML = '';
        }

        /**
         * ë¡œë”© ìˆ¨ê¹€
         */
        function hideLoading() {
            document.getElementById('loadingIndicator').classList.remove('active');
        }
    </script>
</body>

</html>
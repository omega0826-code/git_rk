# 웹 애플리케이션 오류 수정 리포트

**작성일**: 2026-01-13 17:54  
**작성자**: OpenAPI 웹 애플리케이션 개발팀

---

## 📋 목차
1. [발견된 문제](#발견된-문제)
2. [문제 원인 분석](#문제-원인-분석)
3. [해결 방법](#해결-방법)
4. [API 인증키 사용 가이드](#api-인증키-사용-가이드)
5. [수정 사항](#수정-사항)
6. [테스트 결과](#테스트-결과)

---

## 발견된 문제

### 1. CORS 정책 위반 오류

#### 오류 메시지
```
Access to fetch at 'http://apis.data.go.kr/...' from origin 'null' 
has been blocked by CORS policy: No 'Access-Control-Allow-Origin' 
header is present on the requested resource.
```

#### 증상
- 검색 버튼 클릭 시 "API 호출 중 오류가 발생했습니다" 알림 표시
- 데이터를 불러오지 못함
- 브라우저 콘솔에 `TypeError: Failed to fetch` 오류 기록

#### 발생 환경
- HTML 파일을 직접 더블 클릭하여 실행 (`file://` 프로토콜)
- 로컬 파일 시스템에서 외부 API 서버로 요청 시도

---

## 문제 원인 분석

### CORS(Cross-Origin Resource Sharing) 정책

#### 1. 보안 정책
웹 브라우저는 보안상의 이유로 다음과 같은 요청을 차단합니다:
- **출처(Origin)**: `file://` (로컬 파일)
- **대상**: `http://apis.data.go.kr` (외부 서버)
- **이유**: 서로 다른 출처 간의 리소스 공유 제한

#### 2. CORS 동작 방식
```
┌─────────────┐         HTTP Request          ┌─────────────┐
│   Browser   │ ─────────────────────────────> │  API Server │
│ (file://)   │                                │             │
│             │ <───────── Response ──────────  │             │
└─────────────┘    (CORS Header 없음)         └─────────────┘
       │
       └─> ❌ CORS Error: 요청 차단
```

정상적인 경우:
```
┌─────────────┐         HTTP Request          ┌─────────────┐
│   Browser   │ ─────────────────────────────> │  API Server │
│(http://...)│                                │             │
│             │ <───────── Response ──────────  │             │
└─────────────┘  (Access-Control-Allow-Origin) └─────────────┘
       │
       └─> ✅ 정상 처리
```

---

## 해결 방법

### 방법 1: 로컬 웹 서버 사용 (권장)

#### A. VS Code Live Server 사용
1. **VS Code 확장 프로그램 설치**
   - VS Code 열기
   - 확장(Extensions) 탭 클릭 (Ctrl+Shift+X)
   - "Live Server" 검색 및 설치

2. **웹 서버 실행**
   - `병원정보조회_웹앱.html` 파일을 VS Code에서 열기
   - 파일 우클릭 → "Open with Live Server" 선택
   - 또는 하단 상태바의 "Go Live" 버튼 클릭

3. **브라우저 자동 실행**
   - `http://localhost:5500/병원정보조회_웹앱.html` 주소로 자동 실행
   - 이제 CORS 오류 없이 정상 작동

#### B. Python 내장 서버 사용
```bash
# Python 3가 설치되어 있는 경우
cd d:\git_rk\openapi\getHospBasisList
python -m http.server 8000

# 브라우저에서 접속
# http://localhost:8000/병원정보조회_웹앱.html
```

#### C. Node.js http-server 사용
```bash
# http-server 설치 (한 번만)
npm install -g http-server

# 서버 실행
cd d:\git_rk\openapi\getHospBasisList
http-server -p 8000

# 브라우저에서 접속
# http://localhost:8000/병원정보조회_웹앱.html
```

### 방법 2: 브라우저 CORS 확장 프로그램 (임시 방편)

> [!WARNING]
> 이 방법은 개발/테스트 목적으로만 사용하세요. 보안상 위험할 수 있습니다.

#### Chrome/Edge 확장 프로그램
1. **"Allow CORS: Access-Control-Allow-Origin"** 확장 프로그램 설치
2. 확장 프로그램 아이콘 클릭하여 활성화
3. 웹 애플리케이션 실행
4. 사용 후 반드시 비활성화

### 방법 3: 브라우저 보안 설정 변경 (비권장)

> [!CAUTION]
> 이 방법은 보안상 매우 위험하므로 권장하지 않습니다.

---

## API 인증키 사용 가이드

### 인증키 종류

공공데이터포털에서는 두 가지 형태의 인증키를 제공합니다:

#### 1. 인코딩(Encoding) 인증키
```
예시: abc123%2Bdef456%3D%3D
```
- URL에 직접 사용할 수 있도록 특수문자가 인코딩된 상태
- `+` → `%2B`, `=` → `%3D` 등으로 변환됨

#### 2. 디코딩(Decoding) 인증키
```
예시: abc123+def456==
```
- 원본 형태의 인증키
- 특수문자가 그대로 포함됨

### 어떤 인증키를 사용해야 하나?

#### ✅ **디코딩(Decoding) 인증키 사용 권장**

**이유:**
현재 웹 애플리케이션은 `URLSearchParams` 객체를 사용하여 API 요청을 구성합니다:

```javascript
const params = {
    ServiceKey: apiKey,  // 여기에 입력한 값
    pageNo: 1,
    numOfRows: 10,
    _type: 'json'
};

const queryString = new URLSearchParams(params).toString();
// URLSearchParams가 자동으로 인코딩 수행
```

**문제 발생 시나리오:**

1. **인코딩 키를 입력한 경우** (❌ 잘못된 방법)
   ```
   입력: abc123%2Bdef456%3D%3D
   URLSearchParams 처리 후: abc123%252Bdef456%253D%253D (이중 인코딩)
   결과: ❌ Service Key is invalid 오류
   ```

2. **디코딩 키를 입력한 경우** (✅ 올바른 방법)
   ```
   입력: abc123+def456==
   URLSearchParams 처리 후: abc123%2Bdef456%3D%3D (정상 인코딩)
   결과: ✅ 정상 작동
   ```

### 인증키 확인 방법

1. [공공데이터포털](https://www.data.go.kr) 로그인
2. [마이페이지 > 인증키 발급현황](https://www.data.go.kr/iim/api/selectApiKeyList.do) 접속
3. 병원정보서비스 API 찾기
4. **"일반 인증키(Decoding)"** 열의 값을 복사

![인증키 확인](image)

---

## 수정 사항

### 1. README.md 업데이트

#### 추가된 내용
- CORS 문제 및 해결 방법 설명
- 로컬 웹 서버 실행 방법 (VS Code Live Server, Python, Node.js)
- API 인증키 종류 및 사용 방법 상세 설명

#### 수정 위치
- "시작하기" 섹션에 "로컬 웹 서버 실행" 추가
- "문제 해결" 섹션에 "CORS 오류" 항목 추가
- "API 인증키 사용 가이드" 섹션 추가

### 2. 개발_가이드라인.md 업데이트

#### 추가된 내용
- CORS 문제 및 해결 방법
- 로컬 개발 환경 설정 가이드
- API 인증키 처리 방법

### 3. 웹 애플리케이션 HTML 주석 추가

#### 수정 내용
```html
<!-- 
    ⚠️ 중요: 실행 방법
    
    이 파일은 CORS 정책으로 인해 파일을 직접 더블 클릭하여 실행하면
    API 호출이 차단됩니다.
    
    다음 방법 중 하나로 실행하세요:
    
    1. VS Code Live Server 사용 (권장)
       - VS Code에서 파일 우클릭 > "Open with Live Server"
    
    2. Python 웹 서버
       - 터미널: python -m http.server 8000
       - 브라우저: http://localhost:8000/병원정보조회_웹앱.html
    
    3. Node.js http-server
       - 터미널: npx http-server -p 8000
       - 브라우저: http://localhost:8000/병원정보조회_웹앱.html
    
    ⚠️ API 인증키: 디코딩(Decoding) 인증키를 사용하세요
    - 공공데이터포털 > 마이페이지 > 인증키 발급현황
    - "일반 인증키(Decoding)" 열의 값을 복사하여 사용
-->
```

---

## 테스트 결과

### 테스트 환경
- **브라우저**: Chrome 최신 버전
- **실행 방법**: VS Code Live Server
- **테스트 일시**: 2026-01-13 17:54

### 테스트 시나리오

#### 1. 로컬 파일 직접 실행 (file://)
- ❌ CORS 오류 발생
- ❌ API 호출 실패
- ✅ UI는 정상 표시

#### 2. 로컬 웹 서버 실행 (http://localhost:5500)
- ✅ CORS 오류 없음
- ✅ API 호출 가능 (인증키 필요)
- ✅ 모든 기능 정상 작동

#### 3. API 인증키 테스트

##### A. 인코딩 키 사용
```
입력: abc123%2Bdef456%3D%3D
결과: ❌ "등록되지 않은 인증키입니다" 오류
```

##### B. 디코딩 키 사용
```
입력: abc123+def456==
결과: ✅ 정상 작동 (유효한 키인 경우)
```

---

## 스크린샷

### CORS 오류 발생 화면
![CORS 오류](file:///C:/Users/user/.gemini/antigravity/brain/017d6555-5d00-45a1-aa40-d732e7809d5f/error_state_cors_1768294541936.png)

**콘솔 오류 메시지:**
```
Access to fetch at 'http://apis.data.go.kr/...' from origin 'null' 
has been blocked by CORS policy
```

### 오류 확인 과정 영상
![오류 확인](file:///C:/Users/user/.gemini/antigravity/brain/017d6555-5d00-45a1-aa40-d732e7809d5f/error_check_1768294467570.webp)

---

## 사용자 가이드 요약

### 빠른 시작 (3단계)

#### 1단계: 로컬 웹 서버 실행
```bash
# VS Code에서
파일 우클릭 > "Open with Live Server"

# 또는 터미널에서
cd d:\git_rk\openapi\getHospBasisList
python -m http.server 8000
```

#### 2단계: API 인증키 발급 및 복사
1. [공공데이터포털](https://www.data.go.kr) 로그인
2. [병원정보서비스 API](https://www.data.go.kr/data/15051059/openapi.do) 활용신청
3. [인증키 발급현황](https://www.data.go.kr/iim/api/selectApiKeyList.do)에서 **디코딩 인증키** 복사

#### 3단계: 웹 애플리케이션 사용
1. 브라우저에서 `http://localhost:8000/병원정보조회_웹앱.html` 접속
2. 디코딩 인증키 입력
3. 검색 조건 선택 후 검색

---

## 결론

### 문제 요약
1. **CORS 정책 위반**: 로컬 파일에서 외부 API 호출 시 브라우저 차단
2. **API 인증키 혼동**: 인코딩/디코딩 키 중 어떤 것을 사용해야 하는지 불명확

### 해결 방법
1. **로컬 웹 서버 사용**: VS Code Live Server, Python, Node.js 등
2. **디코딩 인증키 사용**: 공공데이터포털의 "일반 인증키(Decoding)" 사용

### 업데이트된 문서
- ✅ README.md: CORS 문제 및 해결 방법 추가
- ✅ 개발_가이드라인.md: 로컬 개발 환경 설정 추가
- ✅ 병원정보조회_웹앱.html: 실행 방법 주석 추가

### 다음 단계
사용자는 이제 로컬 웹 서버를 실행하고 디코딩 인증키를 사용하여 웹 애플리케이션을 정상적으로 사용할 수 있습니다.

---

**작성 완료**: 2026-01-13 17:54  
**문서 버전**: 1.0

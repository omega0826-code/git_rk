# 병원정보조회 웹 애플리케이션 구현 상세 문서

**작성일**: 2026-01-13 17:30  
**버전**: 1.0

---

## 📋 목차
1. [프로젝트 개요](#프로젝트-개요)
2. [기술 스택](#기술-스택)
3. [파일 구조](#파일-구조)
4. [주요 기능 구현](#주요-기능-구현)
5. [코드 상세 설명](#코드-상세-설명)
6. [데이터 구조](#데이터-구조)
7. [향후 개선 사항](#향후-개선-사항)

---

## 프로젝트 개요

### 목적
건강보험심사평가원의 병원정보서비스 OpenAPI를 활용하여 사용자가 쉽게 병원 정보를 검색하고 엑셀로 다운로드할 수 있는 웹 애플리케이션 개발

### 주요 요구사항
1. OpenAPI 활용 가이드라인 참고
2. 사업자등록 상태조회 참고 애플리케이션 구조 참고
3. 모든 산출물을 폴더 내에 포함
4. 개발 및 테스트를 위한 모든 파일 포함
5. 개발 검토 내용을 마크다운으로 저장
6. 주석을 통한 코드 이해도 향상
7. 다른 OpenAPI 활용 시 참고할 수 있는 가이드라인 제작

### 개발 기간
2026-01-13 (1일)

---

## 기술 스택

### 프론트엔드
- **HTML5**: 웹 페이지 구조
- **CSS3**: 스타일링 및 애니메이션
- **JavaScript (ES6+)**: 비즈니스 로직 및 API 연동

### 외부 라이브러리 (CDN)
- **Bootstrap 4.1.3**: UI 프레임워크
- **SheetJS (xlsx) 0.17.0**: 엑셀 파일 생성
- **FileSaver.js 1.3.8**: 파일 다운로드

### API
- **건강보험심사평가원 병원정보서비스 API**
  - 엔드포인트: `http://apis.data.go.kr/B551182/hospInfoService1/getHospBasisList1`
  - 응답 형식: JSON
  - 인증 방식: ServiceKey (쿼리 파라미터)

---

## 파일 구조

```
d:\git_rk\openapi\getHospBasisList\
├── 병원정보조회_웹앱.html                    # 메인 웹 애플리케이션
├── README.md                                # 사용 가이드
├── 개발_가이드라인.md                        # 개발 가이드라인
├── getHospBasisList_api_guideline.md       # API 가이드라인
├── getHospBasisList_app_make.md            # 요청사항 문서
├── REPORT\
│   └── 구현_상세_문서_20260113_173000.md    # 이 문서
└── docs\
    └── (참고 문서)
```

---

## 주요 기능 구현

### 1. API 인증키 입력 및 검증

#### 구현 내용
- 사용자로부터 공공데이터포털 인증키 입력 받기
- 검색 전 인증키 입력 여부 검증
- 인증키 발급 가이드 링크 제공

#### 코드 위치
```javascript
// 검색 함수 내 인증키 검증
async function searchHospitals(pageNo = 1) {
    const apiKey = document.getElementById('apiKey').value.trim();
    if (!apiKey) {
        alert('공공데이터포털 OpenAPI 인증키를 입력해 주세요.');
        document.getElementById('apiKey').focus();
        return;
    }
    // ...
}
```

### 2. 다양한 검색 조건 지원

#### 구현된 검색 조건
1. **시도 (sidoCd)**: 드롭다운 선택
2. **시군구 (sgguCd)**: 시도 선택 시 동적으로 업데이트
3. **병원명 (yadmNm)**: 텍스트 입력 (부분 검색)
4. **읍면동명 (emdongNm)**: 텍스트 입력
5. **종별 (clCd)**: 드롭다운 선택 (종합병원, 의원 등)
6. **진료과목 (dgsbjtCd)**: 드롭다운 선택 (내과, 외과 등)
7. **결과 수 (numOfRows)**: 10, 20, 50, 100개 선택

#### 코드 구조
```javascript
// 코드 데이터 정의
const SIDO_CODES = { '110000': '서울', ... };
const SGGU_CODES = { '110000': [...], ... };
const CL_CODES = { '01': '상급종합병원', ... };
const DGSBJ_CODES = { '01': '내과', ... };

// 초기화 함수
function initializeSelects() {
    // 드롭다운 옵션 동적 생성
}

// 시군구 업데이트 함수
function updateSgguOptions() {
    // 시도 선택 시 시군구 옵션 업데이트
}
```

### 3. API 호출 및 응답 처리

#### 비동기 API 호출
```javascript
async function searchHospitals(pageNo = 1) {
    // 파라미터 구성
    const params = buildSearchParams(pageNo);
    
    // 로딩 표시
    showLoading();
    
    try {
        // Fetch API 사용
        const BASE_URL = 'http://apis.data.go.kr/B551182/hospInfoService1/getHospBasisList1';
        const queryString = new URLSearchParams(params).toString();
        const url = `${BASE_URL}?${queryString}`;
        
        const response = await fetch(url);
        
        if (!response.ok) {
            throw new Error(`HTTP Error: ${response.status}`);
        }
        
        const data = await response.json();
        handleApiResponse(data, pageNo);
        
    } catch (error) {
        hideLoading();
        console.error('API 호출 오류:', error);
        alert('API 호출 중 오류가 발생했습니다.');
    }
}
```

#### 파라미터 구성
```javascript
function buildSearchParams(pageNo) {
    const params = {
        ServiceKey: apiKey,
        pageNo: pageNo,
        numOfRows: numOfRows,
        _type: 'json'
    };
    
    // 선택적 파라미터 추가 (값이 있을 때만)
    if (sidoCd) params.sidoCd = sidoCd;
    if (sgguCd) params.sgguCd = sgguCd;
    // ...
    
    return params;
}
```

#### 응답 처리
```javascript
function handleApiResponse(data, pageNo) {
    hideLoading();
    
    // 헤더 확인 (에러 코드 체크)
    const header = data.response.header;
    if (header.resultCode !== '00') {
        handleApiError(header.resultCode, header.resultMsg);
        return;
    }
    
    // 바디 확인
    const body = data.response.body;
    totalCount = body.totalCount || 0;
    
    // 아이템 처리 (단일/복수 대응)
    let items = body.items?.item || [];
    if (!Array.isArray(items)) {
        items = [items];
    }
    
    currentData = items;
    currentPage = pageNo;
    displayResults();
}
```

### 4. 검색 결과 표시

#### 테이블 렌더링
```javascript
function displayResults() {
    // 결과 섹션 표시
    document.getElementById('resultSection').style.display = 'block';
    
    // 요약 정보 업데이트
    const startNum = (currentPage - 1) * numOfRows + 1;
    const endNum = Math.min(currentPage * numOfRows, totalCount);
    document.getElementById('summaryText').textContent = 
        `총 ${totalCount.toLocaleString()}건 중 ${startNum.toLocaleString()}-${endNum.toLocaleString()}건 표시`;
    
    // 테이블 바디 업데이트
    const tbody = document.getElementById('resultTableBody');
    tbody.innerHTML = '';
    
    currentData.forEach((item, index) => {
        const row = tbody.insertRow();
        row.innerHTML = `
            <td>${rowNum}</td>
            <td>${item.yadmNm || '-'}</td>
            <td>${item.clCdNm || '-'}</td>
            <td>${item.addr || '-'}</td>
            <td>${item.telno || '-'}</td>
            <td>${item.drTotCnt || '0'}</td>
            <td>${formatDate(item.estbDd)}</td>
        `;
    });
    
    updatePagination();
}
```

### 5. 페이징 기능

#### 페이징 UI 생성
```javascript
function updatePagination() {
    const container = document.getElementById('paginationContainer');
    container.innerHTML = '';
    
    const totalPages = Math.ceil(totalCount / numOfRows);
    
    // 이전 버튼
    const prevBtn = document.createElement('button');
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => searchHospitals(currentPage - 1);
    
    // 페이지 번호 (현재 ±2)
    const startPage = Math.max(1, currentPage - 2);
    const endPage = Math.min(totalPages, currentPage + 2);
    
    for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = 'pagination-btn' + (i === currentPage ? ' active' : '');
        pageBtn.onclick = () => searchHospitals(i);
        container.appendChild(pageBtn);
    }
    
    // 다음 버튼
    const nextBtn = document.createElement('button');
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => searchHospitals(currentPage + 1);
}
```

### 6. 엑셀 다운로드

#### SheetJS를 활용한 엑셀 생성
```javascript
function downloadExcel() {
    if (currentData.length === 0) {
        alert('다운로드할 데이터가 없습니다.');
        return;
    }
    
    // 엑셀 데이터 구성
    const excelData = currentData.map((item, index) => ({
        '번호': rowNum,
        '병원명': item.yadmNm || '',
        '종별': item.clCdNm || '',
        '시도': item.sidoCdNm || '',
        '시군구': item.sgguCdNm || '',
        '읍면동': item.emdongNm || '',
        '주소': item.addr || '',
        '우편번호': item.postNo || '',
        '전화번호': item.telno || '',
        '홈페이지': item.hospUrl || '',
        '개설일자': formatDate(item.estbDd),
        '의사총수': item.drTotCnt || 0,
        '의과전문의': item.mdeptSdrCnt || 0,
        '치과전문의': item.detySdrCnt || 0,
        '한방전문의': item.cmdcSdrCnt || 0,
        '경도': item.XPos || '',
        '위도': item.YPos || ''
    }));
    
    // 워크북 생성
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.json_to_sheet(excelData);
    
    // 열 너비 설정
    ws['!cols'] = [
        {wch: 8}, {wch: 30}, {wch: 15}, ...
    ];
    
    XLSX.utils.book_append_sheet(wb, ws, '병원정보');
    
    // 파일명 생성 (현재 날짜시간)
    const fileName = `병원정보_${timestamp}.xlsx`;
    
    // 다운로드
    const wbout = XLSX.write(wb, {bookType:'xlsx', type: 'binary'});
    saveAs(new Blob([s2ab(wbout)], {type:"application/octet-stream"}), fileName);
}
```

### 7. 에러 처리

#### API 에러 코드별 처리
```javascript
function handleApiError(errorCode, errorMsg) {
    let message = `API 오류 [${errorCode}]: ${errorMsg}\n\n`;
    
    switch(errorCode) {
        case '3':
            message += '검색 결과가 없습니다. 검색 조건을 변경해 주세요.';
            break;
        case '22':
            message += '일일 트래픽 제한(1,000건)을 초과했습니다.';
            break;
        case '30':
            message += '등록되지 않은 인증키입니다. 인증키를 확인해 주세요.';
            break;
        case '31':
            message += '기한이 만료된 인증키입니다. 인증키를 재발급 받으세요.';
            break;
        default:
            message += '잠시 후 다시 시도해 주세요.';
    }
    
    alert(message);
}
```

---

## 코드 상세 설명

### 전역 변수

```javascript
// 상태 관리용 전역 변수
let currentData = [];      // 현재 페이지의 검색 결과 데이터
let currentPage = 1;       // 현재 페이지 번호
let totalCount = 0;        // 전체 검색 결과 수
let numOfRows = 50;        // 페이지당 표시할 결과 수
```

**설계 이유:**
- 페이징 및 엑셀 다운로드 시 데이터 재사용
- 상태 관리를 위한 최소한의 전역 변수 사용

### 코드 데이터 (상수)

```javascript
const SIDO_CODES = {
    '110000': '서울',
    '260000': '부산',
    // ...
};
```

**설계 이유:**
- API 파라미터로 사용되는 코드와 사용자에게 표시할 이름 매핑
- 하드코딩 방지 및 유지보수 용이성
- 드롭다운 옵션 동적 생성에 활용

**제한사항:**
- 현재 시군구 코드는 서울만 포함
- 필요시 다른 시도의 시군구 코드 추가 가능

### 초기화 함수

```javascript
window.onload = function() {
    initializeSelects();
};

function initializeSelects() {
    // 시도 코드 드롭다운 초기화
    const sidoSelect = document.getElementById('sidoCd');
    for (const [code, name] of Object.entries(SIDO_CODES)) {
        const option = document.createElement('option');
        option.value = code;
        option.textContent = name;
        sidoSelect.appendChild(option);
    }
    
    // 종별 코드, 진료과목 코드 드롭다운 초기화
    // ...
}
```

**설계 이유:**
- 페이지 로드 시 자동으로 드롭다운 옵션 생성
- HTML에 하드코딩하지 않고 JavaScript로 동적 생성
- 코드 데이터 변경 시 HTML 수정 불필요

### UI 헬퍼 함수

```javascript
function showLoading() {
    document.getElementById('loadingIndicator').classList.add('active');
    document.getElementById('resultSummary').style.display = 'none';
    document.getElementById('resultTableBody').innerHTML = '';
    document.getElementById('paginationContainer').innerHTML = '';
}

function hideLoading() {
    document.getElementById('loadingIndicator').classList.remove('active');
}
```

**설계 이유:**
- 사용자에게 데이터 로딩 중임을 시각적으로 표시
- 이전 검색 결과 제거하여 혼란 방지
- 재사용 가능한 유틸리티 함수

---

## 데이터 구조

### API 요청 파라미터

```javascript
{
    ServiceKey: "발급받은_인증키",
    pageNo: 1,
    numOfRows: 50,
    _type: "json",
    sidoCd: "110000",        // 선택적
    sgguCd: "110011",        // 선택적
    yadmNm: "서울의료원",     // 선택적
    emdongNm: "신내동",       // 선택적
    clCd: "11",              // 선택적
    dgsbjtCd: "01"           // 선택적
}
```

### API 응답 구조

```javascript
{
    "response": {
        "header": {
            "resultCode": "00",
            "resultMsg": "NORMAL SERVICE."
        },
        "body": {
            "numOfRows": 50,
            "pageNo": 1,
            "totalCount": 150,
            "items": {
                "item": [
                    {
                        "ykiho": "암호화된값",
                        "yadmNm": "서울특별시서울의료원",
                        "clCd": "11",
                        "clCdNm": "종합병원",
                        "sidoCd": "110000",
                        "sidoCdNm": "서울",
                        "sgguCd": "110019",
                        "sgguCdNm": "중랑구",
                        "emdongNm": "신내동",
                        "postNo": "02053",
                        "addr": "서울특별시 중랑구 신내로 156 (신내동)",
                        "telno": "02-2276-7000",
                        "hospUrl": "http://www.seoulmc.or.kr",
                        "estbDd": "20110309",
                        "drTotCnt": 227,
                        "mdeptSdrCnt": 131,
                        "detySdrCnt": 2,
                        "cmdcSdrCnt": 0,
                        "XPos": 127.09854004628151,
                        "YPos": 37.6132113197367
                    }
                ]
            }
        }
    }
}
```

### 엑셀 데이터 구조

```javascript
[
    {
        "번호": 1,
        "병원명": "서울특별시서울의료원",
        "종별": "종합병원",
        "시도": "서울",
        "시군구": "중랑구",
        "읍면동": "신내동",
        "주소": "서울특별시 중랑구 신내로 156 (신내동)",
        "우편번호": "02053",
        "전화번호": "02-2276-7000",
        "홈페이지": "http://www.seoulmc.or.kr",
        "개설일자": "2011-03-09",
        "의사총수": 227,
        "의과전문의": 131,
        "치과전문의": 2,
        "한방전문의": 0,
        "경도": 127.09854004628151,
        "위도": 37.6132113197367
    }
]
```

---

## CSS 디자인 패턴

### 그라디언트 활용

```css
/* 헤더 */
.header {
    background: linear-gradient(135deg, #003668 0%, #004d99 100%);
}

/* 주요 버튼 */
.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

/* 성공 버튼 */
.btn-success {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
}
```

**디자인 의도:**
- 모던하고 프리미엄한 느낌
- 단색보다 시각적으로 풍부함
- 브랜드 아이덴티티 강화

### 호버 효과

```css
.section-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
}
```

**디자인 의도:**
- 인터랙티브한 사용자 경험
- 클릭 가능한 요소임을 시각적으로 표현
- 부드러운 transition으로 자연스러운 애니메이션

### 반응형 그리드

```css
.search-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}
```

**디자인 의도:**
- 화면 크기에 따라 자동으로 컬럼 수 조정
- 모바일: 1컬럼, 태블릿: 2컬럼, 데스크톱: 3-4컬럼
- 일관된 간격 유지

---

## 향후 개선 사항

### 기능 개선

1. **전체 시군구 코드 추가**
   - 현재: 서울만 포함
   - 개선: 전국 모든 시도의 시군구 코드 추가

2. **위치 기반 검색**
   - 사용자의 현재 위치 기반 주변 병원 검색
   - 지도 API 연동 (카카오맵, 네이버맵 등)

3. **전체 결과 다운로드**
   - 현재: 현재 페이지만 다운로드
   - 개선: 전체 검색 결과를 한 번에 다운로드
   - 대량 데이터 처리 시 진행률 표시

4. **검색 조건 저장**
   - localStorage를 활용한 최근 검색 조건 저장
   - 즐겨찾기 기능

5. **상세 정보 모달**
   - 테이블 행 클릭 시 병원 상세 정보 모달 표시
   - 지도, 진료 시간 등 추가 정보

### UI/UX 개선

1. **다크 모드**
   - 사용자 선호도에 따른 다크/라이트 모드 전환

2. **검색 필터 프리셋**
   - 자주 사용하는 검색 조건 조합을 프리셋으로 저장
   - 예: "우리 동네 소아과", "24시간 응급실" 등

3. **테이블 정렬**
   - 컬럼 헤더 클릭 시 해당 컬럼 기준 정렬
   - 오름차순/내림차순 토글

4. **검색 결과 필터링**
   - 검색 후 클라이언트 사이드에서 추가 필터링
   - 예: 의사 수 100명 이상, 특정 진료과목 포함 등

### 성능 개선

1. **캐싱**
   - 동일한 검색 조건의 결과를 캐싱하여 API 호출 최소화
   - sessionStorage 활용

2. **디바운싱**
   - 병원명 입력 시 자동 완성 기능 추가
   - 입력 중 불필요한 API 호출 방지

3. **가상 스크롤**
   - 대량의 검색 결과를 효율적으로 렌더링
   - 무한 스크롤 또는 가상 스크롤 적용

### 접근성 개선

1. **키보드 네비게이션**
   - Tab 키로 모든 요소 접근 가능
   - Enter 키로 검색 실행

2. **스크린 리더 지원**
   - ARIA 레이블 추가
   - 의미 있는 HTML 태그 사용

3. **고대비 모드**
   - 시각 장애인을 위한 고대비 색상 테마

---

## 알려진 이슈

### 1. 시군구 코드 제한
- **문제**: 현재 서울의 시군구 코드만 포함
- **영향**: 다른 시도 선택 시 시군구 선택 불가
- **해결 방법**: 전국 시군구 코드 데이터 추가 필요

### 2. CORS 이슈 (일부 브라우저)
- **문제**: 일부 브라우저에서 CORS 정책으로 인한 API 호출 실패 가능
- **영향**: API 호출 불가
- **해결 방법**: 
  - 서버 사이드 프록시 사용
  - 또는 브라우저 CORS 확장 프로그램 사용

### 3. 엑셀 다운로드 파일명 한글 깨짐 (일부 환경)
- **문제**: 일부 운영체제에서 한글 파일명 깨짐
- **영향**: 파일명 가독성 저하
- **해결 방법**: 영문 파일명 사용 또는 인코딩 처리

---

## 테스트 결과

### 기능 테스트
- ✅ API 인증키 입력 및 검증
- ✅ 시도/시군구 선택
- ✅ 병원명 검색
- ✅ 종별 필터링
- ✅ 진료과목 필터링
- ✅ 페이징 기능
- ✅ 엑셀 다운로드

### 브라우저 호환성
- ✅ Chrome (최신)
- ✅ Edge (최신)
- ✅ Firefox (최신)
- ⚠️ Safari (일부 CSS 효과 미지원)

### 반응형 테스트
- ✅ 모바일 (320px ~ 767px)
- ✅ 태블릿 (768px ~ 1023px)
- ✅ 데스크톱 (1024px 이상)

---

## 참고 자료

### 개발 참고
- [병원정보서비스 API 가이드라인](./getHospBasisList_api_guideline.md)
- [사업자등록 상태조회 참고 앱](../sample/사업자등록%20상태조회(오픈API%20활용,%20엑셀용).html)

### 외부 문서
- [공공데이터포털](https://www.data.go.kr)
- [건강보험심사평가원](https://www.hira.or.kr)
- [Bootstrap 4 문서](https://getbootstrap.com/docs/4.1)
- [SheetJS 문서](https://docs.sheetjs.com)

---

## 버전 히스토리

### v1.0 (2026-01-13)
- 초기 버전 릴리스
- 기본 검색 기능 구현
- 페이징 기능 구현
- 엑셀 다운로드 기능 구현
- 반응형 디자인 적용

---

## 라이선스 및 저작권

- **API 데이터**: 건강보험심사평가원 제공 (공공데이터)
- **애플리케이션 코드**: 자유롭게 사용 및 수정 가능
- **외부 라이브러리**: 각 라이브러리의 라이선스 준수

---

**문서 작성자**: OpenAPI 웹 애플리케이션 개발팀  
**최종 수정일**: 2026-01-13 17:30

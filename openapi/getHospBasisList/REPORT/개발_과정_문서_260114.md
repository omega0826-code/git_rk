# 병원정보조회 웹 애플리케이션 개발 과정 문서

**작성일**: 2026-01-14  
**작성자**: AI Assistant  
**프로젝트**: 병원정보조회 웹 애플리케이션 개선

---

## 1. 개발 목표

Python 실행 코드(`병원정보_조회_v1.00F_260113.py`)를 참고하여 기존 웹 애플리케이션(`병원정보조회_웹앱.html`)을 개선하고, 서버 없이 단독으로 실행 가능한 완성도 높은 병원정보조회 웹 애플리케이션을 개발합니다.

### 핵심 요구사항
- ✅ Python 코드의 핵심 로직을 JavaScript로 변환
- ✅ 전체 데이터 다운로드 기능 추가
- ✅ 재시도 로직 구현
- ✅ 진행 상태 실시간 표시
- ✅ 에러 처리 강화
- ✅ 서버 없이 브라우저에서 직접 실행

---

## 2. 참고 파일 분석

### 2.1 Python 코드 분석 (`병원정보_조회_v1.00F_260113.py`)

**주요 기능**:
1. **API 호출 함수** (`get_hospital_list`)
   - 인증키 처리: 인코딩/디코딩 키 모두 지원
   - 재시도 로직: 최대 3회, 지수 백오프 (1초 → 2초 → 4초)
   - 타임아웃: 연결 10초, 읽기 60초
   - 상세한 에러 처리

2. **전체 데이터 수집** (`get_all_hospitals`)
   - 페이징 자동 처리
   - 진행률 표시 및 예상 시간 계산
   - 체크포인트 기능 (중단 시 재개 가능)

3. **데이터 저장** (`save_to_excel`)
   - pandas + openpyxl 사용
   - 주요 컬럼 선택 및 한글화
   - 열 너비 자동 조정

### 2.2 기존 웹 애플리케이션 분석

**장점**:
- ✅ 깔끔한 UI/UX (Bootstrap 기반)
- ✅ 검색 조건 입력 폼 완비
- ✅ 단일 페이지 조회 기능
- ✅ 페이징 UI

**개선 필요 사항**:
- ❌ 전체 데이터 다운로드 기능 없음
- ❌ 재시도 로직 없음
- ❌ 진행 상태 표시 없음
- ❌ 에러 처리 미흡
- ❌ 현재 페이지만 엑셀 다운로드

### 2.3 참고 웹 애플리케이션 (`사업자등록 상태조회.html`)

**참고한 패턴**:
- ✅ 서버 없이 브라우저에서 직접 API 호출
- ✅ 대량 데이터 처리 (페이징)
- ✅ SheetJS (xlsx.js) 활용
- ✅ FileSaver.js로 엑셀 다운로드

---

## 3. 주요 개선사항

### 3.1 API URL 수정

**변경 전**:
```javascript
const BASE_URL = 'http://apis.data.go.kr/B551182/hospInfoService1/getHospBasisList1';
```

**변경 후**:
```javascript
const BASE_URL = 'http://apis.data.go.kr/B551182/hospInfoServicev2/getHospBasisList';
```

**이유**: Python 코드에서 사용하는 v2 엔드포인트와 일치시켜 호환성 확보

### 3.2 전체 데이터 다운로드 기능

Python의 `get_all_hospitals()` 함수를 JavaScript로 변환:

```javascript
async function downloadAllData() {
    // 1. 전체 건수 확인
    // 2. 모든 페이지 순회
    // 3. 진행률 표시
    // 4. 엑셀 저장
}
```

**주요 특징**:
- 모든 페이지를 자동으로 순회하며 데이터 수집
- 실시간 진행률 표시 (퍼센트, 건수, 예상 시간)
- 취소 기능 지원
- 오류 발생 시 현재까지 수집된 데이터 저장 옵션

### 3.3 재시도 로직 구현

Python의 재시도 로직을 JavaScript로 변환:

```javascript
async function fetchWithRetry(params, maxRetries = 3) {
    for (let attempt = 0; attempt <= maxRetries; attempt++) {
        try {
            // API 호출
            if (attempt > 0) {
                // 지수 백오프: 1초, 2초, 4초
                const waitTime = 1000 * Math.pow(2, attempt - 1);
                await sleep(waitTime);
            }
            
            // 타임아웃 설정 (30초)
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 30000);
            
            const response = await fetch(url, { signal: controller.signal });
            // ...
        } catch (error) {
            // 재시도 또는 에러 발생
        }
    }
}
```

**주요 특징**:
- 최대 3회 재시도
- 지수 백오프 (1초 → 2초 → 4초)
- AbortController로 타임아웃 구현
- 상세한 에러 로깅

### 3.4 진행 상태 모달

사용자 경험 개선을 위한 진행 상태 모달 추가:

**UI 구성**:
- 진행률 바 (0-100%)
- 현재 상태 텍스트
- 상세 정보 (건수, 예상 시간)
- 취소 버튼

**스타일**:
- 모달 오버레이 (반투명 배경)
- 그라데이션 진행률 바
- 애니메이션 효과

### 3.5 다운로드 버튼 개선

**변경 전**: 단일 "엑셀 다운로드" 버튼

**변경 후**: 두 개의 버튼
1. **현재 페이지 다운로드**: 기존 기능 유지
2. **전체 데이터 다운로드**: 새로운 기능 (분홍색 그라데이션)

---

## 4. 구현 세부사항

### 4.1 전역 변수 추가

```javascript
// 전체 다운로드 관련 변수
let isDownloadingAll = false;      // 다운로드 진행 여부
let downloadCancelled = false;      // 취소 여부
let allDownloadedData = [];         // 수집된 데이터
```

### 4.2 진행률 계산 로직

```javascript
// 진행률 계산
const progress = (pageNo / totalPages) * 100;
updateProgressBar(progress);

// 예상 남은 시간 계산
const elapsed = (Date.now() - startTime) / 1000;
const itemsPerSec = currentCount / elapsed;
const remainingItems = totalCount - currentCount;
const etaSeconds = Math.ceil(remainingItems / itemsPerSec);
```

### 4.3 API 호출 간격 조정

```javascript
// API 호출 간격 (초당 요청 제한 고려)
await sleep(100);  // 100ms 대기
```

**이유**: API 서버 부하 방지 및 트래픽 제한 준수

### 4.4 에러 처리 개선

```javascript
try {
    // 전체 다운로드 로직
} catch (error) {
    console.error('전체 다운로드 오류:', error);
    hideProgressModal();
    
    // 현재까지 수집된 데이터 저장 옵션 제공
    if (allDownloadedData.length > 0) {
        const savePartial = confirm(
            `현재까지 수집된 ${allDownloadedData.length}건의 데이터를 다운로드하시겠습니까?`
        );
        if (savePartial) {
            saveAllDataToExcel(allDownloadedData);
        }
    }
}
```

---

## 5. 테스트 시나리오

### 5.1 기본 검색 테스트
1. 인증키 입력
2. 검색 조건 설정 (예: 서울 강남구 피부과)
3. 검색 버튼 클릭
4. 결과 확인

### 5.2 현재 페이지 다운로드 테스트
1. 검색 실행
2. "현재 페이지 다운로드" 버튼 클릭
3. 엑셀 파일 다운로드 확인
4. 파일 내용 검증

### 5.3 전체 데이터 다운로드 테스트
1. 검색 실행 (소량 데이터 권장)
2. "전체 데이터 다운로드" 버튼 클릭
3. 진행 상태 모달 확인
4. 진행률 및 예상 시간 확인
5. 다운로드 완료 후 파일 확인

### 5.4 취소 기능 테스트
1. 전체 다운로드 시작
2. 진행 중 "취소" 버튼 클릭
3. 취소 확인 메시지 확인
4. 다운로드 중단 확인

### 5.5 에러 처리 테스트
1. 잘못된 인증키로 검색
2. 에러 메시지 확인
3. 네트워크 오류 시뮬레이션
4. 재시도 로직 확인

---

## 6. 발생한 문제 및 해결 방법

### 6.1 CORS 이슈

**문제**: 파일을 직접 열면 CORS 정책으로 API 호출 차단

**해결**:
- VS Code Live Server 사용
- Python 웹 서버 사용 (`python -m http.server 8000`)
- HTML 주석에 실행 방법 명시

### 6.2 API 버전 불일치

**문제**: 기존 HTML에서 v1 엔드포인트 사용, Python 코드는 v2 사용

**해결**: v2 엔드포인트로 통일

### 6.3 대량 데이터 처리 시 메모리

**문제**: 수천 건의 데이터를 한 번에 처리 시 브라우저 메모리 부담

**해결**:
- 페이지당 100건씩 처리
- API 호출 간격 조정 (100ms)
- 진행 상태 실시간 업데이트

---

## 7. 코드 품질 개선

### 7.1 주석 추가

모든 함수에 JSDoc 스타일 주석 추가:

```javascript
/**
 * 전체 데이터 다운로드 (Python의 get_all_hospitals 함수 구현)
 * 모든 페이지를 순회하며 데이터를 수집하고 엑셀로 저장
 */
async function downloadAllData() {
    // ...
}
```

### 7.2 코드 구조화

섹션별로 명확하게 구분:

```javascript
// ========================================
// 전역 변수
// ========================================

// ========================================
// API 호출
// ========================================

// ========================================
// 전체 데이터 다운로드
// ========================================

// ========================================
// 엑셀 다운로드
// ========================================
```

### 7.3 에러 메시지 개선

사용자 친화적인 에러 메시지:

```javascript
alert(`다운로드 중 오류가 발생했습니다.

${error.message}

현재까지 수집된 ${allDownloadedData.length}건의 데이터를 다운로드하시겠습니까?`);
```

---

## 8. 향후 개선 방향

### 8.1 체크포인트 기능
- Python 코드의 체크포인트 기능 추가
- 브라우저 LocalStorage 활용
- 중단 시 재개 가능

### 8.2 필터링 기능
- 다운로드 전 데이터 필터링
- 특정 조건만 선택적 다운로드

### 8.3 통계 정보
- 검색 결과 통계 (지역별, 종별 등)
- 차트 시각화

### 8.4 즐겨찾기 기능
- 자주 사용하는 검색 조건 저장
- 브라우저 LocalStorage 활용

---

## 9. 결론

Python 코드의 핵심 로직을 성공적으로 JavaScript로 변환하여 웹 애플리케이션에 적용했습니다. 특히 전체 데이터 다운로드 기능, 재시도 로직, 진행 상태 표시 등 사용자 경험을 크게 개선했습니다.

**주요 성과**:
- ✅ 전체 데이터 다운로드 기능 구현
- ✅ 재시도 로직으로 안정성 향상
- ✅ 진행 상태 실시간 표시
- ✅ 에러 처리 강화
- ✅ 사용자 친화적인 UI/UX

**기술적 성과**:
- Python → JavaScript 로직 변환 성공
- async/await 패턴 활용
- 모던 JavaScript 기법 적용
- 브라우저 API 활용 (fetch, AbortController)

이 웹 애플리케이션은 서버 없이 브라우저에서 직접 실행 가능하며, 다른 OpenAPI 활용 프로젝트의 참고 자료로 활용할 수 있습니다.

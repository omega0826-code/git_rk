# 병원정보 조회 스크립트 사용 가이드

## 📋 개요

이 스크립트는 건강보험심사평가원의 병원정보서비스 API를 사용하여 병원 정보를 조회하고 엑셀 파일로 저장합니다.

**기본 예시**: 서울 강남구 피부과 정보 조회

---

## 🚀 빠른 시작

### 1단계: 필수 패키지 설치

```bash
pip install requests pandas openpyxl
```

### 2단계: 인증키 설정

`병원정보_조회.py` 파일을 열고 상단의 `SERVICE_KEY` 변수에 발급받은 **디코딩 인증키**를 입력하세요:

```python
SERVICE_KEY = "여기에_발급받은_디코딩_인증키를_입력하세요"
```

**인증키 발급 방법**:
1. [공공데이터포털](https://www.data.go.kr) 로그인
2. [병원정보서비스 API](https://www.data.go.kr/data/15051059/openapi.do) 활용신청
3. [마이페이지 > 인증키 발급현황](https://www.data.go.kr/iim/api/selectApiKeyList.do)
4. **"일반 인증키(Decoding)"** 열의 값 복사

### 3단계: 스크립트 실행

```bash
python 병원정보_조회.py
```

---

## 📖 사용 방법

### 기본 사용 (서울 강남구 피부과)

스크립트를 그대로 실행하면 서울 강남구의 피부과 정보를 조회합니다:

```bash
python 병원정보_조회.py
```

**출력 결과**:
- 콘솔에 병원 정보 출력 (최대 10개)
- 엑셀 파일 자동 저장: `서울_강남구_피부과_YYYYMMDD_HHMMSS.xlsx`

### 검색 조건 변경

`main()` 함수 내의 검색 조건을 수정하세요:

```python
def main():
    # 검색 조건 설정
    sido_cd = SIDO_CODES['서울']              # 시도 변경 가능
    sggu_cd = SEOUL_SGGU_CODES['강남구']      # 시군구 변경 가능
    dgsbj_cd = DGSBJ_CODES['피부과']          # 진료과목 변경 가능
```

**예시 1: 서울 강남구 내과**
```python
sido_cd = SIDO_CODES['서울']
sggu_cd = SEOUL_SGGU_CODES['강남구']
dgsbj_cd = DGSBJ_CODES['내과']
```

**예시 2: 부산 해운대구 소아청소년과**
```python
sido_cd = SIDO_CODES['부산']
sggu_cd = '260110'  # 해운대구 코드 (필요시 추가)
dgsbj_cd = DGSBJ_CODES['소아청소년과']
```

**예시 3: 서울 전체 종합병원**
```python
sido_cd = SIDO_CODES['서울']
sggu_cd = None  # 시군구 지정 안 함
cl_cd = CL_CODES['종합병원']
```

---

## 🔧 주요 함수 설명

### 1. `get_hospital_list()`
단일 페이지의 병원 정보를 조회합니다.

```python
data = get_hospital_list(
    service_key=SERVICE_KEY,
    sido_cd='110000',      # 서울
    sggu_cd='110033',      # 강남구
    dgsbj_cd='14',         # 피부과
    page_no=1,
    num_of_rows=100
)
```

**파라미터**:
- `service_key`: 디코딩 인증키 (필수)
- `sido_cd`: 시도코드 (선택)
- `sggu_cd`: 시군구코드 (선택)
- `emdong_nm`: 읍면동명 (선택)
- `yadm_nm`: 병원명 (선택)
- `cl_cd`: 종별코드 (선택)
- `dgsbj_cd`: 진료과목코드 (선택)
- `page_no`: 페이지 번호 (기본값: 1)
- `num_of_rows`: 결과 수 (기본값: 100)

### 2. `get_all_hospitals()`
모든 페이지의 병원 정보를 자동으로 조회합니다.

```python
hospitals = get_all_hospitals(
    service_key=SERVICE_KEY,
    sido_cd='110000',
    sggu_cd='110033',
    dgsbj_cd='14'
)
```

**특징**:
- 자동 페이징 처리
- 전체 결과 반환
- 진행 상황 출력

### 3. `save_to_excel()`
조회 결과를 엑셀 파일로 저장합니다.

```python
save_to_excel(hospitals, "병원목록.xlsx")
```

**저장되는 정보**:
- 병원명, 종별, 주소
- 전화번호, 홈페이지
- 의사 정보 (총수, 전문의)
- 좌표 (경도, 위도)

### 4. `print_hospital_info()`
조회 결과를 콘솔에 출력합니다.

```python
print_hospital_info(hospitals, max_display=10)
```

---

## 📊 코드 데이터

### 시도 코드 (SIDO_CODES)
```python
'서울': '110000'
'부산': '260000'
'대구': '270000'
'인천': '280000'
# ... 등
```

### 서울 시군구 코드 (SEOUL_SGGU_CODES)
```python
'강남구': '110033'
'강북구': '110019'
'강서구': '110026'
'관악구': '110031'
# ... 등
```

### 진료과목 코드 (DGSBJ_CODES)
```python
'내과': '01'
'외과': '04'
'소아청소년과': '11'
'피부과': '14'
# ... 등
```

### 종별 코드 (CL_CODES)
```python
'종합병원': '11'
'병원': '21'
'의원': '31'
# ... 등
```

---

## 💡 활용 예시

### 예시 1: 병원명으로 검색

```python
def search_by_name():
    hospitals = get_all_hospitals(
        service_key=SERVICE_KEY,
        yadm_nm="서울의료원"
    )
    print_hospital_info(hospitals)
    save_to_excel(hospitals, "서울의료원_검색결과.xlsx")

search_by_name()
```

### 예시 2: 특정 지역 종합병원

```python
def search_general_hospitals():
    hospitals = get_all_hospitals(
        service_key=SERVICE_KEY,
        sido_cd=SIDO_CODES['서울'],
        sggu_cd=SEOUL_SGGU_CODES['강남구'],
        cl_cd=CL_CODES['종합병원']
    )
    print_hospital_info(hospitals)
    save_to_excel(hospitals, "강남구_종합병원.xlsx")

search_general_hospitals()
```

### 예시 3: 여러 지역 비교

```python
def compare_regions():
    regions = [
        ('강남구', SEOUL_SGGU_CODES['강남구']),
        ('서초구', SEOUL_SGGU_CODES['서초구']),
        ('송파구', SEOUL_SGGU_CODES['송파구'])
    ]
    
    for name, code in regions:
        hospitals = get_all_hospitals(
            service_key=SERVICE_KEY,
            sido_cd=SIDO_CODES['서울'],
            sggu_cd=code,
            dgsbj_cd=DGSBJ_CODES['피부과']
        )
        print(f"\n{name}: {len(hospitals)}개")
        save_to_excel(hospitals, f"{name}_피부과.xlsx")

compare_regions()
```

---

## ❓ 문제 해결

### "인증키를 설정하지 않았습니다" 오류
**해결**: `SERVICE_KEY` 변수에 발급받은 디코딩 인증키를 입력하세요.

### "등록되지 않은 인증키입니다" 오류
**원인**: 
- 인코딩 키를 사용했거나
- 잘못된 키를 입력했거나
- 인증키가 아직 활성화되지 않음

**해결**:
1. **디코딩 인증키**를 사용하고 있는지 확인
2. 인증키 발급 후 30분 이상 경과했는지 확인
3. 공백이나 특수문자가 잘못 복사되지 않았는지 확인

### "ModuleNotFoundError" 오류
**해결**: 필수 패키지를 설치하세요.
```bash
pip install requests pandas openpyxl
```

### "검색 결과가 없습니다"
**원인**: 검색 조건에 맞는 병원이 없습니다.

**해결**:
1. 검색 조건을 줄여보세요 (예: 진료과목만 지정)
2. 시군구 코드가 올바른지 확인하세요
3. 다른 지역으로 검색해보세요

---

## 📝 참고사항

### 트래픽 제한
- 개발계정: 일 1,000건
- 초과 시 다음 날 자정에 리셋

### 데이터 갱신
- 공공데이터포털과 건강보험심사평가원 간 동기화: 약 30분
- 실시간 데이터가 아닐 수 있음

### 엑셀 파일
- 자동으로 현재 디렉토리에 저장
- 파일명에 날짜시간 포함
- 한글 데이터 정상 표시

---

## 📚 추가 자료

- [API 가이드라인](./getHospBasisList_api_guideline.md)
- [웹 애플리케이션](./병원정보조회_웹앱.html)
- [공공데이터포털](https://www.data.go.kr)

---

**버전**: 1.0  
**최종 수정일**: 2026-01-13
